<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Universal Smart Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background: #000;
            overflow: hidden;
        }

        #player-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: black;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        video {
            position: absolute;
            background: #000;
        }
    </style>
</head>
<body>

<div id="player-container">
    <video id="video" playsinline webkit-playsinline controls></video>
</div>

<script>

    /* ---------------------------------------------------------
       GITHUB SABİT YAYIN DOSYASI
    --------------------------------------------------------- */
    const PLAYLIST_URL = "https://utay88.github.io/Utay88/live/trt1.m3u8";

    const video = document.getElementById("video");

    /* ---------------------------------------------------------
       CİHAZ ORANINA GÖRE AKILLI ÖLÇEK
       (Her ekranda taşmasız – Netflix/YouTube tarzı)
    --------------------------------------------------------- */
    function resizeVideo() {
        const videoRatio = 16 / 9; // TRT oranı
        const screenRatio = window.innerWidth / window.innerHeight;

        if (screenRatio > videoRatio) {
            video.style.width = "100vw";
            video.style.height = "auto";
        } else {
            video.style.height = "100vh";
            video.style.width = "auto";
        }
    }

    window.addEventListener("resize", resizeVideo);
    window.addEventListener("orientationchange", resizeVideo);

    /* ---------------------------------------------------------
       PLAYER → GitHub m3u8 dosyasını çek
    --------------------------------------------------------- */
    async function loadPlaylist() {
        try {
            const response = await fetch(PLAYLIST_URL + "?t=" + Date.now());
            const urlText = await response.text();
            return urlText.trim(); 
        } catch (error) {
            console.error("Yayın yüklenemedi:", error);
            return null;
        }
    }

    /* ---------------------------------------------------------
       HLS PLAYER
    --------------------------------------------------------- */
    async function startStream() {

        const streamUrl = await loadPlaylist();
        if (!streamUrl) {
            console.log("Yayın bulunamadı.");
            return;
        }

        console.log("Açılan yayın:", streamUrl);

        if (Hls.isSupported()) {

            const hls = new Hls({
                maxBufferLength: 10,
                maxMaxBufferLength: 60,
                enableWorker: true,
                lowLatencyMode: true
            });

            hls.loadSource(streamUrl);
            hls.attachMedia(video);

            // EN YÜKSEK KALİTE SABİTLE
            hls.on(Hls.Events.MANIFEST_PARSED, function () {
                let max = hls.levels.length - 1;
                hls.currentLevel = max;
                video.play();
                resizeVideo();
            });

            // HATA KORUMA
            hls.on(Hls.Events.ERROR, function (event, data) {
                if (data.fatal) {
                    if (data.type === Hls.ErrorTypes.NETWORK_ERROR) {
                        hls.startLoad();
                    } else if (data.type === Hls.ErrorTypes.MEDIA_ERROR) {
                        hls.recoverMediaError();
                    }
                }
            });

        } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
            video.src = streamUrl;
            video.play();
        }

        resizeVideo();
    }

    startStream();

</script>

</body>
</html>
