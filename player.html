<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Player</title>

<style>
html, body {
    margin:0;
    padding:0;
    background:#000;
    height:100%;
    overflow:hidden;
}
#video {
    width:100%;
    height:100%;
    background:#000;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

</head>
<body>

<video id="video" controls autoplay playsinline></video>

<script>
// JSON’dan okunan yayın linki
const url = "https://raw.githubusercontent.com/utay88/Utay88/main/kontrol.json";

let hls;
let currentChannel = null;

// JSON'u oku
async function loadJSON() {
    try {
        let r = await fetch(url + "?t=" + Date.now());
        let data = await r.json();
        if (data.channel && data.channel !== currentChannel) {
            currentChannel = data.channel;
            startStream(currentChannel);
        }
    } catch (e) {
        console.log("JSON okunamadı", e);
    }
}

// Hızlı açılan HLS player
function startStream(src) {
    const video = document.getElementById("video");

    if (hls) {
        hls.destroy();
        hls = null;
    }

    if (Hls.isSupported()) {
        hls = new Hls({
            maxMaxBufferLength: 3,   // HIZLI AÇILMA İÇİN OPTİMUM
            startPosition: -1,       // ANINDA BAŞLATIR
            manifestLoadingTimeOut: 8000,
            manifestLoadingMaxRetry: 5
        });

        hls.loadSource(src);
        hls.attachMedia(video);

        hls.on(Hls.Events.MANIFEST_PARSED, function () {
            video.play().catch(()=>{});
        });

        hls.on(Hls.Events.ERROR, function () {
            setTimeout(() => startStream(src), 2000);
        });

    } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
        video.src = src;
        video.play().catch(()=>{});
    }
}

// İlk başlatma
loadJSON();

// 5 saniyede bir yayın değişti mi kontrol et
setInterval(loadJSON, 5000);
</script>

</body>
</html>
