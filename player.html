<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Canlı Yayın</title>

<!-- Cache kapalı -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />

<style>
body {
    margin: 0;
    background: black;
}
#my-video {
    width: 100%;
    height: 100vh;
    object-fit: contain;
    background: black;
}

/* İSTENMEYEN KONTROLLERİ SAKLA */
.vjs-progress-control,
.vjs-remaining-time,
.vjs-current-time,
.vjs-time-divider,
.vjs-duration,
.vjs-volume-panel,
.vjs-playback-rate,
.vjs-picture-in-picture-control,
.vjs-seek-to-live-control {
    display: none !important;
}

/* Control bar düzeni */
.vjs-control-bar {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 0 8px !important;
}

/* LIVE etiketi */
.vjs-live-pill {
    color: #fff;
    background: #e53935;
    padding: 3px 10px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 600;
    margin: 0 8px;
}

/* Buton tıklama alanlarını büyüt */
.vjs-control {
    min-width: 40px !important;
}
</style>
</head>

<body>

<video
  id="my-video"
  class="video-js vjs-default-skin vjs-big-play-centered"
  controls
  autoplay
  playsinline
></video>

<!-- VideoJS -->
<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>

<!-- HLS -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
// GitHub JSON
const kontrolURL = "https://raw.githubusercontent.com/Utay88/Utay88/main/kontrol.json";

let currentStream = "";
let hls = null;

// Player
const player = videojs("my-video", {
    autoplay: true,
    controls: true,
    preload: "auto",
    liveui: true
});

// Alt bara LIVE etiketi ekle
player.ready(function () {
    const controlBar = player.getChild('controlBar');
    const barEl = controlBar.el();

    const liveEl = document.createElement("div");
    liveEl.className = "vjs-live-pill";
    liveEl.textContent = "LIVE";

    // Tam ekran butonunun soluna yerleştir
    const fsBtn = barEl.querySelector(".vjs-fullscreen-control");
    barEl.insertBefore(liveEl, fsBtn);
});

// JSON kontrolü
function checkStream() {
    fetch(kontrolURL + "?t=" + Date.now())
        .then(r => r.json())
        .then(data => {
            if (data.yayin && data.yayin !== currentStream) {
                currentStream = data.yayin;
                loadStream(currentStream);
            }
        })
        .catch(e => console.log("JSON okunamadı:", e));
}

// Yayını yükle
function loadStream(url) {
    if (hls) {
        hls.destroy();
        hls = null;
    }

    if (Hls.isSupported()) {
        hls = new Hls({
            enableWorker: true,
            startLevel: -1   // Otomatik, genelde en iyi kaliteye çıkar
        });

        hls.loadSource(url);
        hls.attachMedia(player.tech().el_);

        hls.on(Hls.Events.MANIFEST_PARSED, () => {
            player.play();
        });

    } else {
        // HLS desteklemeyen eski cihazlar için fallback
        player.src({ src: url, type: "application/x-mpegURL" });
        player.play();
    }
}

// Başlat
checkStream();
setInterval(checkStream, 3000);
</script>

</body>
</html>
