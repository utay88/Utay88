<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>TV Player</title>

<!-- CLAPPR -->
<script src="https://cdn.jsdelivr.net/npm/@clappr/player@latest/dist/clappr.min.js"></script>

<!-- QUALITY PLUGIN -->
<script src="https://cdn.jsdelivr.net/gh/clappr/clappr-level-selector-plugin@latest/dist/level-selector.min.js"></script>

<style>
html,body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background:#000;
    overflow:hidden;
}
#player{
    width:100vw;
    height:100vh;
    position:fixed;
    top:0;left:0;
}
</style>
</head>

<body>
<div id="player"></div>

<script>
// ===============================
// JSON URL — BUNU DEĞİŞTİRECEKSİN
// ===============================
const jsonURL = "https://seningithubadın/raw/main/channel.json";

let currentSrc = "";
let player = null;

// GERÇEK ÇÖZÜNÜRLÜK OKUMA
function trueLabel(level){
    if (level && level.height) return level.height + "p";

    // fallback (Clappr index modeli)
    const map = {
        0:"360p",
        1:"480p",
        2:"720p",
        3:"1080p",
        4:"1440p",
        5:"2160p"
    };

    if (level && typeof level.index !== "undefined") {
        return map[level.index] || "Otomatik";
    }

    return "Otomatik";
}

function startPlayer(src){
    if(player){ player.destroy(); }

    player = new Clappr.Player({
        source: src,
        parentId: "#player",
        autoPlay: true,
        width: "100%",
        height: "100%",
        fullscreenEnabled: true,

        plugins: [LevelSelector],
        levelSelectorConfig: {
            title: "Çözünürlük",
            labelCallback: trueLabel
        },

        playback: {
            playInline: true,
            autoplay: true
        }
    });
}

// JSON’dan sürekli kontrol (kanal değişince otomatik geçiş)
function loadJSON(){
    fetch(jsonURL)
    .then(r => r.json())
    .then(j => {
        if(j.channel && j.channel !== currentSrc){
            currentSrc = j.channel;
            startPlayer(currentSrc);
        }
    });
}

loadJSON();
setInterval(loadJSON, 3000); // 3 sn’de bir yayın kontrolü

</script>
</body>
</html>
