<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Canlı Yayın</title>

<!-- Cache sorunu OLMASIN diye -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />

<style>
body { margin:0; background:black; }
#my-video { width:100%; height:100vh; object-fit:contain; }
</style>
</head>

<body>

<video
  id="my-video"
  class="video-js vjs-default-skin vjs-big-play-centered"
  controls
  autoplay
  playsinline
></video>

<!-- VideoJS -->
<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>

<!-- HLS -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<!-- Kalite seviyeleri -->
<script src="https://cdn.jsdelivr.net/npm/videojs-contrib-quality-levels/dist/videojs-contrib-quality-levels.min.js"></script>

<!-- Çözünürlük seçici -->
<script src="https://cdn.jsdelivr.net/npm/videojs-http-source-selector/dist/videojs-http-source-selector.min.js"></script>

<script>
const kontrolURL = "https://raw.githubusercontent.com/Utay88/Utay88/main/kontrol.json";

let currentStream = "";
let hls = null;

// Player
const player = videojs("my-video", {
    autoplay: true,
    controls: true,
    preload: "auto"
});

// Çözünürlük butonunu aktif et
player.ready(() => {
    player.httpSourceSelector({
        default: "auto"
    });
});

// JSON kontrolü
function checkStream() {
    fetch(kontrolURL + "?t=" + Date.now())
        .then(r => r.json())
        .then(data => {
            if (data.yayin && data.yayin !== currentStream) {
                currentStream = data.yayin;
                loadStream(currentStream);
            }
        })
        .catch(e => console.log("JSON okunamadı:", e));
}

// Yayını yükle
function loadStream(url) {
    if (hls) {
        hls.destroy();
        hls = null;
    }

    if (Hls.isSupported()) {
        hls = new Hls({ enableWorker: true });
        hls.loadSource(url);
        hls.attachMedia(player.tech().el_);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
            player.play();
        });
    } else {
        player.src({ src: url, type: "application/x-mpegURL" });
        player.play();
    }
}

// İlk yükleme
checkStream();

// Her 3 saniyede bir yayın değişti mi kontrol et
setInterval(checkStream, 3000);
</script>

</body>
</html>
