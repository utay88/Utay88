<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>TV Player</title>

<style>
body {margin:0;padding:0;background:#000;overflow:hidden;}
#player {width:100vw;height:100vh;position:fixed;top:0;left:0;}
</style>

<script src="https://cdn.jsdelivr.net/npm/@clappr/player@latest/dist/clappr.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/clappr/clappr-level-selector-plugin@latest/dist/level-selector.min.js"></script>

</head>
<body>

<div id="player"></div>

<script>

const jsonURL = "https://raw.githubusercontent.com/utay88/Utay88/main/kontrol.json";


/* Çözünürlük düzeltici */
function fixedQualityLabel(level) {
    if (level && level.height) return level.height + "p";

    const index = level?.index ?? 0;
    const map = {
        0: "360p",
        1: "480p",
        2: "720p",
        3: "1080p",
        4: "1440p"
    };
    return map[index] || "Otomatik";
}


let player;


/* Player başlatma */
function startPlayer(source) {
    player = new Clappr.Player({
        source: source,
        parentId: "#player",
        autoPlay: true,
        mute: true,               // AUTOPLAY İÇİN GEREKLİ
        height: "100%",
        width: "100%",
        plugins: [LevelSelector],
        levelSelectorConfig: {
            title: "Çözünürlük",
            labelCallback: fixedQualityLabel
        },
        playback: {
            autoplay: true,
            playInline: true
        }
    });

    // 1 saniye sonra sesi aç
    setTimeout(() => player.setVolume(100), 1200);
}


/* JSON'u oku ve yayını güncelle */
function loadStream() {
    fetch(jsonURL + "?t=" + Date.now())   // CACHE KAPALI
        .then(r => r.json())
        .then(data => {
            if (!player) {
                startPlayer(data.channel);
            } else {
                // Yayın değiştiyse hemen güncelle
                player.configure({ source: data.channel });
            }
        });
}

/* İlk yükleme */
loadStream();

/* Her 5 saniyede bir yayın değişti mi kontrol et */
setInterval(loadStream, 5000);

</script>

</body>
</html>
