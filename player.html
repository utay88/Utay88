<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CanlÄ± YayÄ±n</title>

<style>
    body { margin:0; background:black; overflow:hidden; }
    #videoContainer { width:100vw; height:100vh; position:relative; background:black; display:flex; justify-content:center; align-items:center; }
    video { width:100%; height:100%; object-fit:contain; background:black; }

    /* Alt barÄ± tekrar gÃ¶rÃ¼nÃ¼r hale getirme ve dÃ¼zeltme */
    #controls {
        position:absolute; bottom:0; left:0;
        width:100%; height:55px;
        background:rgba(0,0,0,0.55);
        display:flex; align-items:center; /* Ã–ÄŸeleri dikeyde ortala */
        padding:0 12px;
        opacity:1; /* BaÅŸlangÄ±Ã§ta gÃ¶rÃ¼nÃ¼r olsun */
        transition:opacity .3s;
        box-sizing: border-box; /* Padding ve border kutu boyutuna dahil edilsin */
        user-select: none; /* Metin seÃ§imini engelle */
    }

    #liveTag {
        color:white; font-size:15px; display:flex; align-items:center;
        margin-right:10px; flex-shrink:0;
    }
    #liveTag::before {
        content:""; width:10px; height:10px; background:red;
        border-radius:50%; margin-right:6px; display:inline-block;
    }

    /* Progress bar'Ä± tekrar gÃ¶rÃ¼nÃ¼r hale getirme (isteÄŸe baÄŸlÄ±, canlÄ± yayÄ±nda genelde olmaz) */
    #progress { flex:1; margin:0 12px; min-width:0; /*display:none; /* Bu satÄ±rÄ± kaldÄ±rarak progress barÄ± gÃ¶ster */ }
    #progress input { width:100%; display:block; }

    #volumeBtn, #fsBtn {
        font-size:28px; color:white; margin-left:10px;
        cursor:pointer; flex-shrink:0;
    }

    /* YayÄ±n aÃ§Ä±lana kadar gÃ¶sterilecek merkezdeki bÃ¼yÃ¼k oynat butonu */
    #playOverlay {
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        z-index: 10;
    }
    #playOverlay.hidden {
        display: none;
    }
    #playOverlay svg {
        width: 100px;
        height: 100px;
        fill: white;
        opacity: 0.8;
    }
</style>
</head>

<body>

<div id="videoContainer">
    <video id="player" autoplay playsinline></video>

    <div id="playOverlay">
        <svg viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z"/>
        </svg>
    </div>

    <div id="controls">
        <div id="liveTag">CANLI</div>

        <div id="progress">
            <input type="range" id="seek" min="0" max="100" value="0">
        </div>

        <div id="volumeBtn">ğŸ”Š</div>
        <div id="fsBtn">â›¶</div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
const kontrolURL = "https://raw.githubusercontent.com/Utay88/Utay88/main/kontrol.json";
const CHECK_INTERVAL = 1000; // 1 saniyede bir kontrol et

let video = document.getElementById("player");
let controls = document.getElementById("controls");
let seek = document.getElementById("seek");
let playOverlay = document.getElementById("playOverlay");
let hideControlsTimer;
let hls;
let currentStream = "";

/* -------------------------
   ALT BAR OTOMATÄ°K GÄ°ZLENME (Åimdi daha yumuÅŸak geÃ§iÅŸli)
--------------------------*/
function showControls() {
    controls.style.opacity = 1;
    clearTimeout(hideControlsTimer);
    hideControlsTimer = setTimeout(() => {
        controls.style.opacity = 0;
    }, 3000);
}

// Fare hareket ettiÄŸinde veya tÄ±klandÄ±ÄŸÄ±nda kontrolleri gÃ¶ster
document.body.addEventListener("mousemove", showControls);
document.body.addEventListener("click", showControls);
video.addEventListener("play", showControls); // Video oynadÄ±ÄŸÄ±nda da gÃ¶ster
video.addEventListener("pause", showControls); // Video durduÄŸunda da gÃ¶ster

// Sayfa yÃ¼klendiÄŸinde kontrolleri gÃ¶ster ve sonra gizle
showControls();

/* -------------------------
   YAYINI YÃœKLE
--------------------------*/
function loadStream(url) {
    if (!url) {
        console.warn("YayÄ±n URL'si boÅŸ. YayÄ±n baÅŸlatÄ±lamÄ±yor.");
        return;
    }

    if (hls) {
        hls.destroy();
        hls = null;
    }
    video.src = ""; // Ã–nceki videoyu temizle

    if (Hls.isSupported()) {
        hls = new Hls({
            // CanlÄ± yayÄ±n iÃ§in dÃ¼ÅŸÃ¼k gecikme ayarlarÄ±
            maxMaxBufferLength: 3, // Daha agresif buffer boyutu
            liveSyncDurationCount: 3,
            liveMaxLatencyDurationCount: 5,
            enableWorker: true,
            // CORS sorunlarÄ±nÄ± hafifletebilecek ayarlar
            crossOrigin: 'anonymous'
        });

        hls.loadSource(url);
        hls.attachMedia(video);

        // HLS.js olaylarÄ±nÄ± izleyerek hata ayÄ±klama
        hls.on(Hls.Events.ERROR, function (event, data) {
            console.error("HLS.js HATA:", data.type, data.details, data.fatal ? "(Fatal)" : "", data);
            if (data.fatal) {
                switch(data.type) {
                    case Hls.ErrorTypes.NETWORK_ERROR:
                        console.error("NETWORK ERROR: Medya verisi yÃ¼klenemedi. URL'yi kontrol edin veya CORS hatasÄ± olabilir.");
                        // Yeniden deneme mekanizmasÄ± eklenebilir
                        break;
                    case Hls.ErrorTypes.MEDIA_ERROR:
                        console.error("MEDIA ERROR: Medya oynatma hatasÄ±.");
                        hls.recoverMediaError();
                        break;
                    default:
                        // Fatal olmayan hatalarda da hls.destroy() ve yeniden yÃ¼kleme denenebilir
                        hls.destroy();
                        setTimeout(() => loadStream(url), 1000); // 1 saniye sonra yeniden dene
                        break;
                }
            }
        });

        hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
            console.log("HLS Manifest Parsed:", data);
            if (data.levels && data.levels.length > 0) {
                // En yÃ¼ksek kaliteye sabitle
                let highest = data.levels.length - 1;
                hls.currentLevel = highest;
                console.log("YayÄ±n kalitesi en yÃ¼kseÄŸe ayarlandÄ±:", hls.levels[highest].height || "Bilinmiyor");
            }
            tryPlayVideo();
        });

        hls.on(Hls.Events.LEVEL_SWITCHING, function (event, data) {
            // EÄŸer otomatik kalite deÄŸiÅŸimi olursa ve en yÃ¼ksek deÄŸilse, tekrar en yÃ¼kseÄŸe zorla
            if (hls.levels && data.level !== hls.levels.length - 1) {
                hls.nextLevel = hls.levels.length - 1;
            }
        });
        hls.on(Hls.Events.BUFFER_APPENDED, function() {
            // Tampona veri eklendiÄŸinde oynatma butonu gizlensin
            playOverlay.classList.add("hidden");
        });

    } else if (video.canPlayType('application/vnd.apple.mpegurl')) { // Safari desteÄŸi
        video.src = url;
        tryPlayVideo();
    } else {
        console.error("TarayÄ±cÄ± HLS formatÄ±nÄ± desteklemiyor.");
        alert("ÃœzgÃ¼nÃ¼m, tarayÄ±cÄ±nÄ±z bu video formatÄ±nÄ± desteklemiyor.");
    }
}

/* -------------------------
   VÄ°DEOYU OYNATMA GÄ°RÄ°ÅÄ°MÄ°
--------------------------*/
function tryPlayVideo() {
    video.play()
        .then(() => {
            console.log("Video oynatÄ±lÄ±yor...");
            playOverlay.classList.add("hidden"); // BaÅŸarÄ±lÄ±ysa oynatma butonu gizlenir
        })
        .catch(e => {
            console.error("Video oynatÄ±lamadÄ±:", e.name, e.message);
            // Otomatik oynatma engellenmiÅŸ olabilir, kullanÄ±cÄ±ya bir mesaj gÃ¶sterilebilir
            playOverlay.classList.remove("hidden"); // Hata olursa oynatma butonu gÃ¶rÃ¼nÃ¼r kalÄ±r
            if (e.name === "NotAllowedError") {
                console.warn("TarayÄ±cÄ± otomatik oynatmayÄ± engelledi. LÃ¼tfen oynat butonuna tÄ±klayÄ±n.");
            }
        });
}

/* -------------------------
   JSON TAKÄ°P VE YENÄ° YAYIN YÃœKLEME
--------------------------*/
function checkStream() {
    // Cache'i Ã¶nlemek iÃ§in sorgu parametresi eklendi
    fetch(kontrolURL + "?t=" + Date.now())
        .then(r => {
            if (!r.ok) {
                throw new Error(`HTTP hata kodu: ${r.status}`);
            }
            return r.json();
        })
        .then(d => {
            if (d.yayin && d.yayin !== currentStream) {
                console.log("Yeni yayÄ±n bulundu:", d.yayin);
                currentStream = d.yayin;
                loadStream(currentStream);
            } else if (!d.yayin) {
                console.warn("kontrol.json iÃ§inde 'yayin' anahtarÄ± bulunamadÄ± veya boÅŸ.");
            }
        })
        .catch(e => {
            console.error("YayÄ±n kontrol hatasÄ±:", e);
            // Hata durumunda da oynatma butonunu gÃ¶ster
            playOverlay.classList.remove("hidden");
        });
}
// Kontrol aralÄ±ÄŸÄ± kÄ±saltÄ±ldÄ±
setInterval(checkStream, CHECK_INTERVAL);
checkStream(); // Sayfa yÃ¼klenir yÃ¼klenmez ilk kontrolÃ¼ yap

/* -------------------------
   MERKEZ OYNAT BUTONU TIKLAMASI
--------------------------*/
playOverlay.addEventListener("click", () => {
    tryPlayVideo();
});

/* -------------------------
   SEEK BAR (CanlÄ± yayÄ±nda genellikle gereksizdir ancak alt bar dÃ¼zeltildiÄŸi iÃ§in bÄ±rakÄ±ldÄ±)
--------------------------*/
video.addEventListener("timeupdate", () => {
    if (!video.duration || video.duration === Infinity || isNaN(video.duration)) {
        seek.value = 0; // CanlÄ± yayÄ±n iÃ§in sÄ±fÄ±rda tut
        seek.disabled = true; // Seek bar'Ä± etkisizleÅŸtir
        return;
    }
    seek.disabled = false;
    seek.value = (video.currentTime / video.duration) * 100;
});
seek.addEventListener("input", () => {
    if (video.duration && video.duration !== Infinity && !isNaN(video.duration)) {
        video.currentTime = (seek.value / 100) * video.duration;
    }
});

/* -------------------------
   SES
--------------------------*/
document.getElementById("volumeBtn").onclick = () => {
    video.muted = !video.muted;
    document.getElementById("volumeBtn").textContent = video.muted ? "ğŸ”‡" : "ğŸ”Š";
};

/* -------------------------
   TAM EKRAN
--------------------------*/
document.getElementById("fsBtn").onclick = () => {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
        document.getElementById("fsBtn").textContent = "ğŸ—–"; // Tam ekrandan Ã§Ä±kma ikonu
    } else {
        document.exitFullscreen();
        document.getElementById("fsBtn").textContent = "â›¶"; // Tam ekran ikonu
    }
};

// Video meta verileri yÃ¼klendiÄŸinde varsayÄ±lan sesi %50 olarak ayarla
video.addEventListener('loadedmetadata', function() {
    video.volume = 0.5;
});
</script>

</body>
</html>
